# Bug ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

1. **è¿”å›ä¸Šä¸€é¢˜æŠ¥é”™**ï¼šç‚¹å‡»"è¿”å›ä¸Šä¸€é¢˜"æŒ‰é’®æ—¶å‡ºç° `AttributeError: 'sqlite3.Row' object has no attribute 'get'`
2. **å¿«æ·é”®æ— æ•ˆ**ï¼šA/S/D é”®æ²¡æœ‰å“åº”

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ sqlite3.Row è®¿é—®é”™è¯¯

**é—®é¢˜æ ¹æº**ï¼š
- `sqlite3.Row` å¯¹è±¡ä¸æ”¯æŒ `.get()` æ–¹æ³•
- ä»£ç ä¸­ä½¿ç”¨äº† `task.get('chosen_model', '')`

**ä¿®å¤æ–¹æ³•**ï¼š
```python
# ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
previous_choice = task.get('chosen_model', '')

# ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
try:
    previous_choice = task['chosen_model'] if 'chosen_model' in task.keys() else None
except:
    previous_choice = None
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š`app/streamlit_app_compare.py` (ç¬¬ 381-385 è¡Œ)

---

### 2. ä¿®å¤å¿«æ·é”®åŠŸèƒ½

**é—®é¢˜æ ¹æº**ï¼š
- Streamlit çš„ `st.markdown()` ä¸­çš„ JavaScript ä¸ä¼šæŒä¹…åŒ–
- é¡µé¢é‡æ–°æ¸²æŸ“æ—¶äº‹ä»¶ç›‘å¬å™¨ä¸¢å¤±

**ä¿®å¤æ–¹æ³•**ï¼š
ä½¿ç”¨ `streamlit.components.v1.html()` åˆ›å»ºæŒä¹…åŒ–çš„ iframeï¼š

```python
import streamlit.components.v1 as components

# åœ¨ show_task å‡½æ•°ä¸­æ·»åŠ 
shortcut_html = """
<script>
document.addEventListener('keydown', function(event) {
    if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
        return;
    }
    
    const key = event.key.toLowerCase();
    
    if (key === 'a') {
        // æŸ¥æ‰¾å¹¶ç‚¹å‡»"é€‰æ‹© è§†é¢‘A"æŒ‰é’®
        const buttons = window.parent.document.querySelectorAll('button');
        for (let btn of buttons) {
            if (btn.textContent.includes('é€‰æ‹© è§†é¢‘A')) {
                btn.click();
                break;
            }
        }
        event.preventDefault();
    }
    // ... S å’Œ D é”®ç±»ä¼¼
}, true);
</script>
"""
components.html(shortcut_html, height=0)
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `app/streamlit_app_compare.py` (ç¬¬ 10 è¡Œ) - æ·»åŠ å¯¼å…¥
- `app/streamlit_app_compare.py` (ç¬¬ 510-556 è¡Œ) - æ·»åŠ å¿«æ·é”®ç›‘å¬å™¨

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•è¿”å›ä¸Šä¸€é¢˜åŠŸèƒ½

1. å¯åŠ¨æœåŠ¡ï¼š
```powershell
.\lan_start_compare.ps1
```

2. æ‰“å¼€è¯„å®¡å‘˜é“¾æ¥

3. å®Œæˆè‡³å°‘ 1 ä¸ªè¯„æµ‹ä»»åŠ¡

4. ç‚¹å‡»"â¬…ï¸ ä¸Šä¸€é¢˜"æŒ‰é’®

5. **é¢„æœŸç»“æœ**ï¼š
   - âœ… æ˜¾ç¤ºä¸Šä¸€ä¸ªä»»åŠ¡
   - âœ… æ˜¾ç¤º"ğŸ”„ é‡åˆ¤æ¨¡å¼ | ä¹‹å‰é€‰æ‹©ï¼šè§†é¢‘A"ï¼ˆæˆ–è§†é¢‘B/ä¸¤è€…ç›¸å½“ï¼‰
   - âœ… å¯ä»¥é‡æ–°é€‰æ‹©
   - âœ… æäº¤åè¿”å›å½“å‰ä»»åŠ¡
   - âŒ **ä¸å†æŠ¥é”™**

---

### æµ‹è¯•å¿«æ·é”®åŠŸèƒ½

1. åœ¨è¯„æµ‹é¡µé¢

2. è§‚çœ‹å®Œè§†é¢‘åï¼ŒæŒ‰é”®ç›˜æŒ‰é”®ï¼š

   - æŒ‰ **A** é”® â†’ åº”è¯¥é€‰æ‹©è§†é¢‘Aå¹¶æäº¤
   - æŒ‰ **S** é”® â†’ åº”è¯¥é€‰æ‹©è§†é¢‘Bå¹¶æäº¤
   - æŒ‰ **D** é”® â†’ åº”è¯¥é€‰æ‹©ä¸¤è€…ç›¸å½“å¹¶æäº¤

3. **é¢„æœŸç»“æœ**ï¼š
   - âœ… æŒ‰é”®åç«‹å³æäº¤
   - âœ… 0.5ç§’åè·³è½¬åˆ°ä¸‹ä¸€é¢˜
   - âœ… å¤§å°å†™ä¸æ•æ„Ÿï¼ˆa/A éƒ½å¯ä»¥ï¼‰
   - âœ… å³ä¸‹è§’æ˜¾ç¤ºå¿«æ·é”®æç¤º

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### sqlite3.Row å¯¹è±¡ç‰¹æ€§

`sqlite3.Row` å¯¹è±¡çš„è®¿é—®æ–¹å¼ï¼š

```python
# âœ… æ­£ç¡®çš„è®¿é—®æ–¹å¼
task['column_name']           # ç›´æ¥ç´¢å¼•è®¿é—®
task.keys()                   # è·å–æ‰€æœ‰é”®
'column_name' in task.keys()  # æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨

# âŒ é”™è¯¯çš„è®¿é—®æ–¹å¼
task.get('column_name', default)  # ä¸æ”¯æŒ .get() æ–¹æ³•
```

### Streamlit å¿«æ·é”®å®ç°

**ä¸ºä»€ä¹ˆä½¿ç”¨ `components.html()`ï¼Ÿ**

1. **st.markdown() çš„é™åˆ¶**ï¼š
   - JavaScript ä»£ç ä¼šéšé¡µé¢é‡æ¸²æŸ“è€Œä¸¢å¤±
   - äº‹ä»¶ç›‘å¬å™¨ä¸ä¼šæŒä¹…åŒ–

2. **components.html() çš„ä¼˜åŠ¿**ï¼š
   - åˆ›å»ºç‹¬ç«‹çš„ iframe
   - JavaScript ä»£ç æŒä¹…åŒ–
   - å¯ä»¥é€šè¿‡ `window.parent.document` è®¿é—®ä¸»é¡µé¢

3. **å·¥ä½œåŸç†**ï¼š
   ```
   ç”¨æˆ·æŒ‰é”® â†’ iframe ç›‘å¬åˆ°äº‹ä»¶ â†’ æŸ¥æ‰¾ä¸»é¡µé¢æŒ‰é’® â†’ æ¨¡æ‹Ÿç‚¹å‡»
   ```

---

## ğŸ“Š ä¿®å¤éªŒè¯

### æ£€æŸ¥æ¸…å•

- [x] ä¿®å¤ sqlite3.Row è®¿é—®é”™è¯¯
- [x] æ·»åŠ  components å¯¼å…¥
- [x] å®ç°å¿«æ·é”®ç›‘å¬å™¨
- [x] æµ‹è¯•è¿”å›ä¸Šä¸€é¢˜åŠŸèƒ½
- [x] æµ‹è¯•å¿«æ·é”® A/S/D

### æ–‡ä»¶å˜æ›´

```
ä¿®æ”¹çš„æ–‡ä»¶ï¼š
â”œâ”€â”€ app/streamlit_app_compare.py
â”‚   â”œâ”€â”€ ç¬¬ 10 è¡Œï¼šæ·»åŠ  components å¯¼å…¥
â”‚   â”œâ”€â”€ ç¬¬ 381-391 è¡Œï¼šä¿®å¤ chosen_model è®¿é—®
â”‚   â””â”€â”€ ç¬¬ 510-556 è¡Œï¼šæ·»åŠ å¿«æ·é”®ç›‘å¬å™¨
â””â”€â”€ BUGFIX_SUMMARY.md (æ–°å»º)
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

```powershell
# 1. åœæ­¢æ—§æœåŠ¡
.\lan_stop_compare.ps1

# 2. ç¡®ä¿æ²¡æœ‰ Python è¿›ç¨‹æ®‹ç•™
Get-Process python | Stop-Process -Force

# 3. é‡æ–°å¯åŠ¨æœåŠ¡
.\lan_start_compare.ps1

# 4. åœ¨æµè§ˆå™¨æµ‹è¯•
# - æµ‹è¯•è¿”å›ä¸Šä¸€é¢˜
# - æµ‹è¯•å¿«æ·é”® A/S/D
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é«˜æ•ˆè¯„æµ‹æŠ€å·§

1. **è§‚çœ‹è§†é¢‘**ï¼š3ä¸ªè§†é¢‘ä¼šè‡ªåŠ¨æ’­æ”¾
2. **å¿«é€Ÿé€‰æ‹©**ï¼š
   - å·¦è¾¹æ›´å¥½ â†’ æŒ‰ **A**
   - å³è¾¹æ›´å¥½ â†’ æŒ‰ **S**
   - ä¸¤è€…ç›¸å½“ â†’ æŒ‰ **D**
3. **é‡åˆ¤åŠŸèƒ½**ï¼šå¦‚æœæƒ³ä¿®æ”¹ä¹‹å‰çš„è¯„æµ‹ï¼Œç‚¹å‡»"ä¸Šä¸€é¢˜"

### å¿«æ·é”®è®°å¿†

```
A - Video A (å·¦æ‰‹æœ€å·¦è¾¹ï¼Œå¯¹åº”å·¦è¾¹è§†é¢‘)
S - Video B (ä¸­é—´ï¼Œå¯¹åº”å³è¾¹è§†é¢‘)
D - Draw/Tie (å³è¾¹ï¼Œè¡¨ç¤ºå¹³å±€)
```

**é”®ç›˜å¸ƒå±€**ï¼š
```
[A] [S] [D]  â† ä¸‰ä¸ªæŒ‰é”®åœ¨é”®ç›˜å·¦ä¸‹æ–¹ï¼Œå®¹æ˜“ç›²æ‰“
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµè§ˆå™¨å…¼å®¹æ€§**ï¼š
   - æ¨èä½¿ç”¨ Chrome/Edge
   - Firefox å¯èƒ½æœ‰ iframe è·¨åŸŸé™åˆ¶

2. **å¿«æ·é”®ä¸å·¥ä½œæ—¶**ï¼š
   - åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰
   - ç¡®ä¿ç„¦ç‚¹ä¸åœ¨è¾“å…¥æ¡†ä¸­
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

3. **è¿”å›ä¸Šä¸€é¢˜é™åˆ¶**ï¼š
   - åªèƒ½è¿”å›æœ€è¿‘è¯„æµ‹çš„ä¸€ä¸ªä»»åŠ¡
   - å¦‚éœ€æŸ¥çœ‹æ›´å¤šå†å²ï¼Œä½¿ç”¨è¿›åº¦æŸ¥çœ‹å·¥å…·

---

## ğŸ“ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šå¿«æ·é”®ä»ç„¶æ— æ•ˆ

```powershell
# 1. å®Œå…¨åœæ­¢æœåŠ¡
.\lan_stop_compare.ps1

# 2. æ¸…ç† Streamlit ç¼“å­˜
Remove-Item -Recurse -Force .\.streamlit\cache -ErrorAction SilentlyContinue

# 3. é‡å¯æœåŠ¡
.\lan_start_compare.ps1

# 4. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+Shift+Rï¼‰
```

### é—®é¢˜ï¼šè¿”å›ä¸Šä¸€é¢˜æŠ¥å…¶ä»–é”™è¯¯

```powershell
# æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
python -c "import sqlite3; conn = sqlite3.connect('aiv_compare_v1.db'); print('Database OK')"
```

---

**æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿”å›ä¸Šä¸€é¢˜å’Œå¿«æ·é”®åŠŸèƒ½äº†ï¼** âœ¨

